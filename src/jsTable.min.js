/*
 * This file is part of the Arnapou jsTable package.
 *
 * (c) Arnaud Buathier <arnaud@arnapou.net>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function(e){var t={each:function(e){if(typeof e!=="function"){throw"this is not a valid callback for each method."}var t,n=this.length;for(t=0;t<n;t++){e.call(this,this[t])}return this},select:function(e,t){if(typeof e!=="function"){throw"this is not a valid callback for each method."}var r=new n([],t||this.uniqueIndex);var i,s=this.length;for(i=0;i<s;i++){r.push(e.call(this,this[i]))}return r},group:function(t,r,i,s){if(typeof r!=="object"){throw"initial argument is not a valid object."}if(typeof i!=="function"){throw"reduce argument is not a valid function."}var o=function(e){var t={};for(var n in e){t[n]=e[n]}return t};var u=typeof t==="function";var a={};this.each(function(e){var n=(u?t:function(e){var n="";for(var r in t){n+=String(e[r])+"::"}return n})(e);if(typeof a[n]==="undefined"){a[n]=[]}a[n].push(e)});var f=new n([],u?"__key__":e),l,c,h;for(var p in a){c=a[p].length;h=o(r);if(u){h["__key__"]=p}else{for(l in t){h[l]=a[p][0][l]}}for(l=0;l<c;l++){i.call(h,a[p][l])}if(typeof s==="function"){s.call(h)}f.push(h)}return f},find:function(e){var t,i=this.length;var s,o;s=new n([],this.uniqueIndex);if(!(e instanceof r)){if(typeof e==="object"){var u=e;e=n.and();for(o in u){e.equalTo(o,u[o])}}else if(this.hasUniqueIndex()){var a=e;e=n.and().equalTo(this.uniqueIndex,a)}else{throw"condition is not a valid argument."}}for(t=0;t<i;t++){if(e.match(this[t])){s.push(this[t])}}return s},findOne:function(e){var t=this.find(e);if(t&&t.length){return t[0]}return null},slice:function(){var e=this.__slice.apply(this,arguments);return new n(e,this.uniqueIndex)},limit:function(e,t){return this.slice(e,t)},sort:function(e,t){t=t||false;return this.__sort(function(n,r){for(var i in e){if(typeof (e[i]==="string")){if(typeof n[i]==="undefined"||typeof r[i]==="undefined"){return 0}var s=n[i];var o=r[i];if(!t){s=typeof s==="string"?String(s).toLowerCase():s;o=typeof o==="string"?String(o).toLowerCase():o}if(s<o){return-e[i]}else if(s>o){return e[i]}}}return 0})},getUniqueIndex:function(){return this.uniqueIndex},hasUniqueIndex:function(){return this.uniqueIndex?true:false},push:function(e){if(this.hasUniqueIndex()){if(typeof e[this.uniqueIndex]!=="undefined"){this.indexes[e[this.uniqueIndex]]=e}}return this.__push(e)},rebuildUniqueIndex:function(){this.indexes={};if(this.hasUniqueIndex()){var e,t=this.length;for(e=0;e<t;e++){if(typeof this[e][this.uniqueIndex]!=="undefined"){this.indexes[this[e][this.uniqueIndex]]=this[e]}}}},setUniqueIndex:function(e){this.uniqueIndex=e;this.rebuildUniqueIndex()}};var n=function(e,r){if(!n.isArray(e)){throw"data is not a valid object of type Array."}var i;var s=e.slice(0);s.indexes={};for(var i in t){(function(e){if(s[e]){s["__"+e]=s[e]}s[e]=function(){return t[e].apply(s,arguments)}})(i)}s.setUniqueIndex(r);return s};n.and=function(){return new r("and")};n.or=function(){return new r("or")};n.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var r=function(e){this.condition=e==="or"?new s(null,[],true,"or"):new s(null,[],true,"and");this.add=function(e){this.condition.add(e);return this};this.match=function(e){return this.condition.match(e)};this.notMatch=function(e){return!this.condition.match(e)};this.greaterThan=function(e,t,n){var r=new s(e,t,n,"greaterThan");this.condition.add(r);return this};this.greaterThanOrEqual=function(e,t,n){var r=new s(e,t,n,"greaterThanOrEqual");this.condition.add(r);return this};this.lowerThan=function(e,t,n){var r=new s(e,t,n,"lowerThan");this.condition.add(r);return this};this.lowerThanOrEqual=function(e,t,n){var r=new s(e,t,n,"lowerThanOrEqual");this.condition.add(r);return this};this.equalTo=function(e,t,n){var r=new s(e,t,n,"equalTo");this.condition.add(r);return this};this.notEqualTo=function(e,t,n){var r=new s(e,t,n,"equalTo");this.condition.add(new s(null,r,true,"not"));return this};this.inArray=function(e,t){if(!n.isArray(t)){throw"the argument is not a valid object of type Array."}var r=new s(e,t,true,"inArray");this.condition.add(r);return this};this.notInArray=function(e,t){if(!n.isArray(t)){throw"the argument is not a valid object of type Array."}var r=new s(e,t,true,"inArray");this.condition.add(new s(null,r,true,"not"));return this};this.regexp=function(e,t){if(!(t instanceof RegExp)){throw"the argument is not a valid object of type RegExp."}var n=new s(e,t,true,"regexp");this.condition.add(n);return this};this.notRegexp=function(e,t){if(!(t instanceof RegExp)){throw"the argument is not a valid object of type RegExp."}var n=new s(e,t,true,"regexp");this.condition.add(new s(null,n,true,"not"));return this};this.callback=function(e){if(typeof e!=="function"){throw"the argument is not a valid function."}var t=new s(null,e,true,"callback");this.condition.add(t);return this};this.notCallback=function(e){if(typeof e!=="function"){throw"the argument is not a valid function."}var t=new s(null,e,true,"callback");this.condition.add(new s(null,t,true,"not"));return this}};var i={callback:function(e){return this.value(e)},inArray:function(e){var t,n=this.value.length;for(t=0;t<n;t++){if(this.value[t]==e){return true}}return false},regexp:function(e){return String(e).match(this.value)},equalTo:function(e){return e==this.value},greaterThan:function(e){return e>this.value},greaterThanOrEqual:function(e){return e>=this.value},lowerThan:function(e){return e<this.value},lowerThanOrEqual:function(e){return e<=this.value},not:function(e){return!this.value.match(e)},or:function(e){var t=this.value.length,n;for(n=0;n<t;n++){if(this.value[n].match(e)){return true}}return false},and:function(e){var t=this.value.length,n;for(n=0;n<t;n++){if(!this.value[n].match(e)){return false}}return true}};var s=function(e,t,n,r){var s=this;var o=typeof t;this.value=t;if(typeof e==="string"){if(n){this.match=function(t){if(typeof t[e]==="undefined"){return false}return i[r].call(this,t[e])}}else{if(o==="string"){s.value=String(t).toLowerCase()}this.match=function(t){if(typeof t[e]==="undefined"){return false}if(typeof t[e]==="string"){return i[r].call(this,String(t[e]).toLowerCase())}else{return i[r].call(this,t[e])}}}}else{this.match=function(e){return i[r].call(this,e)};if(r==="or"||r==="and"){this.add=function(e){this.value.push(e)}}}};this.jsTable=n}).call(this)
